<!DOCTYPE html>
<HTML manifest___xxx="BiblePad-2015.appcache">

<HEAD>
    <TITLE>cuvs</TITLE>
    <META http-equiv="Content-Type" content="text/html;" charset="UTF-8">
    <META name="viewport" content="width=device-witdh, initial-scale=1, maximum-scale=1, user-scale=0">




    <script>
        var gStartDate = new Date();
        console.log(gStartDate.toString() + " ------ start load");//
    </script>



    <script language="javascript" src="../../htmjs/jq/jquery.js">
    </script>
    <script language="javascript" src="../../htmjs/jq/table_Indexer.js">
    </script>
    <script language="javascript" src="../../htmjs/jq/jquery.tablesorter.js"></script>


    <script language="javascript" src="../../../jsdb/jsBibleStruct/BBE.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/CUVS.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/H_G.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/KJV.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/NIV.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/PINYIN.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/STUS.json.js"></script>
    <script language="javascript" src="../../../jsdb/jsBibleStruct/WLVS.json.js"></script>



    <script src="http://localhost:7778/Jsonpster/"></script>


    </script>








    <script>
        console.log((new Date()).toString());//
    </script>
    <style>
        body {
    background-color: black;
    color: white;
    width:100%;
	font-size: 100%;
	
    padding:0px 0px 0px 0px;
    margin: 0px 0px 0px 0px;	

    font-family: 'Times New Roman';
}
.hili{
    background-color: red; 
}
sub{
    font-size: 8px;
}
#BibInputMenuHolder{
    position:fixed;
    top:10px;
    right: 20px;
    opacity: 100;
    background-color: rgb(51, 158, 158);
}
</style>



    <script language="javascript">
        var gBim = null;//new BibleInputMenu("#BibInputMenuHolder", H_G_struct);
            
        $(document).ready(function () {
            gBim = new BibleInputMenu("#BibInputMenuHolder", H_G_struct);
        
            gBim.init();
            gBim.Gen_Keys_Menu();

            $("#load").click(function () {
                var ret = gBim.get_chap_by_selected();
                $("#out").val(JSON.stringify(ret, null, 4));

                restapi_loadBibleObj("test", ret);
            });

            table_sort();
            //table_col_index();
        });/////////////


        var BibleInputMenu = function (menuId, Obj) {
            this.m_menuHolderId = menuId;

            this.m_keytbid = "#key_bdy";
            this.m_voltbid = "#vol_bdy";
            this.m_chptbid = "#chp_bdy";
            this.m_vrstbid = "#vrs_tbd";

            this.m_structObj = Obj;
        }
        BibleInputMenu.prototype.init = function () {
            var stables = `   
        <table border="0">
            <caption id="">First Letter of Volume Name<a id='vname'></a></caption>
            <thead id="inoutkeyhdr"></thead>
            <tbody id='key_bdy'></tbody>
        </table>
        <table border="1" style="float:left;">
            <caption class='vcvCap' id='vol_cap'>Vol</caption>
            <thead id="vol_hdr"></thead>
            <tbody id='vol_bdy'>
                <tr>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <table border="1" style="float:left;">
            <caption class='vcvCap' id='chp_cap'>__chapters__</caption>
            <thead id="chp_hdr"></thead>
            <tbody id='chp_bdy'>
                <tr>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <table border="1" style="float:left;">
            <caption class='vcvCap' id='vrs_cap'>Verses</caption>
            <thead id="vrs_hdr"></thead>
            <tbody id='vrs_tbd'>
                <tr>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <button id="loadVolChpVrs" onclick='restapi_loadBibVolChpVrs();'>Load</button><br>
        <button id="run">-</button>
        <br>`;
            $(this.m_menuHolderId).html(stables);
        }
        BibleInputMenu.prototype.get_vol_trs_match_str = function (ch) {
            var s = "", i = 0;
            Object.keys(this.m_structObj).forEach(function (vol) {
                if (vol.indexOf(ch) == 0) {
                    s += "<tr><td/><td class='v3'>" + vol + "</td></tr>";
                    i++;
                };
            });
            return { trs: s, size: i };
        };

        BibleInputMenu.prototype.Fresh_Caption_Txt = function () {
            var ret = this.get_chap_by_selected();
            if (!ret.vol) ret.vol = "-";
            if (!ret.chp) ret.chp = "-";
            if (!ret.vrs) ret.vrs = "-";
            $("#vol_cap").text(ret.vol);
            $("#chp_cap").text(ret.chp);
            $("#vrs_cap").text(ret.vrs);
        }

        BibleInputMenu.prototype.Gen_Keys_Menu = function () {
            var ks = this.get_cha_arr_after_str(this.m_structObj, "");

            var s = "<tr id='vitr'>";
            var _This = this;
            $.each(ks, function (i, c) {
                c = c + "<sub>" + _This.get_vol_trs_match_str(c).size + "</sub>";
                s += "<td><button class='vin'>" + c + "</button></td>";
                if (9 == i) s += "</tr><tr>";
            });
            s += "</tr>";

            $(_This.m_keytbid).html(s).find(".vin").bind("click", function () {
                $(".vin").removeClass("hili");
                $(this).addClass("hili");
                var ch = $(this).text();
                var ret = _This.get_vol_trs_match_str(ch[0]);
                $(_This.m_voltbid).html(ret.trs).find(".v3").bind("click", function () {
                    var vol = $(this).text();
                    $(".v3").removeClass("hili");
                    $(this).addClass("hili");
                    _This.Fresh_Caption_Txt();
                    //$("#out").val(vol);
                    $(_This.m_vrstbid).html("");
                    _This.gen_Chap_Menu(_This.m_structObj[vol]);
                });
                $(_This.m_chptbid).html("");
                $(_This.m_vrstbid).html("");
                $(".vcvCap").text(".");
            });
            return ks;
        }

        BibleInputMenu.prototype.get_cha_arr_after_str = function (obj, str) {
            if (!obj) return [];
            var ret = {};
            Object.keys(obj).forEach(function (v) {
                if (v.indexOf(str) == 0) {
                    var idx = str.length;
                    if (v.length > idx) {
                        var ch = v[idx];
                        if (!ret[ch]) ret[ch] = 0;
                        ret[ch]++;
                    }
                }
            });
            var ks = Object.keys(ret).sort();
            return ks;
        }
        BibleInputMenu.prototype.get_chap_by_selected = function () {
            var vol = $(".v3.hili").text();

            var chparr = ["", "", ""];
            chparr[0] = $(this.m_chptbid).find(".chpos0.hili").text().charAt(0);
            chparr[1] = $(this.m_chptbid).find(".chpos1.hili").text().charAt(0);
            chparr[2] = $(this.m_chptbid).find(".chpos2.hili").text().charAt(0);

            var arr = ["", "", ""];
            arr[0] = $(this.m_vrstbid).find(".chpos0.hili").text().charAt(0);
            arr[1] = $(this.m_vrstbid).find(".chpos1.hili").text().charAt(0);
            arr[2] = $(this.m_vrstbid).find(".chpos2.hili").text().charAt(0);
            return { vol: vol, chp: chparr.join(""), vrs: arr.join("") };
        }




        BibleInputMenu.prototype.chp_table_init = function (tid, uobj) {
            if (!uobj) return;
            var maxchp = "000";// + Object.keys(uobj).length;
            var n = maxchp.length;

            var s = "";
            for (var i = 0; i < 10; i++) {
                s += "<tr>";
                for (var k = 0; k < n; k++) {
                    s += "<td class='chpos" + k + "' chprow='" + i + "' chpcol='" + k + "'>" + "</td>";
                }
                s += "</tr>";
            };
            var chpTab = $(tid).html(s);
            return chpTab;
        };


        BibleInputMenu.prototype.chp_table_fill_col = function (tid, uobj, icol, keysearch) {
            var _This = this;
            var p0ar = _This.get_cha_arr_after_str(uobj, keysearch);
            $(tid).find(".chpos" + icol).each(function (i) {
                var row = $(this).attr("chprow");
                var irow = parseInt(row);
                if (p0ar[irow]) {
                    var ch = p0ar[irow];
                    var nxAr = _This.get_cha_arr_after_str(uobj, keysearch + ch);
                    var ssub = "" + nxAr.length;
                    if (nxAr.length === 0) ssub = "";
                    $(this).html(ch + "<sub>" + ssub + "</sub>");
                } else {
                    $(this).text("");
                }
            });
        };
        BibleInputMenu.prototype.chp_table_bind_col = function (tid, uobj, icol, cbfunc) {
            var _This = this;
            $(tid).find(".chpos" + icol).bind("click", function () {
                var ss = $(this).text();
                if (ss.length === 0) return;

                for (var i = icol; i < 3; i++) {
                    $(tid).find(".chpos" + i).removeClass("hili");
                }

                $(this).addClass("hili");
                _This.Fresh_Caption_Txt();


                var ssrch = cbfunc();
                _This.chp_table_fill_col(tid, uobj, 1 + icol, ssrch);

                if (Object.keys(uobj[ssrch]).length == 0) return;
                _This.gen_verse_Menu(uobj[ssrch]);
            });
        }
        BibleInputMenu.prototype.gen_Chap_Menu = function (vobj) {
            var _This = this;
            function get_search_str_by_hili() {
                var ret = _This.get_chap_by_selected();
                return ret.chp;
            }
            //var vobj = BsObj[Vol];
            this.chp_table_init(this.m_chptbid, vobj);
            this.chp_table_fill_col(this.m_chptbid, vobj, 0, get_search_str_by_hili());
            this.chp_table_bind_col(this.m_chptbid, vobj, 0, get_search_str_by_hili);
            this.chp_table_bind_col(this.m_chptbid, vobj, 1, get_search_str_by_hili);
            this.chp_table_bind_col(this.m_chptbid, vobj, 2, get_search_str_by_hili);

        };

        BibleInputMenu.prototype.gen_verse_Menu = function (vobj) {
            var _This = this;
            function get_search_str_by_hili() {
                var ret = _This.get_chap_by_selected();
                console.log(ret);
                return ret.vrs;
            }
            //var vobj = BsObj[Vol];
            this.chp_table_init(this.m_vrstbid, vobj);
            this.chp_table_fill_col(this.m_vrstbid, vobj, 0, get_search_str_by_hili());
            this.chp_table_bind_col(this.m_vrstbid, vobj, 0, get_search_str_by_hili);
            this.chp_table_bind_col(this.m_vrstbid, vobj, 1, get_search_str_by_hili);
            this.chp_table_bind_col(this.m_vrstbid, vobj, 2, get_search_str_by_hili);
        };

        ///////////
        //////////
        //////////
        //////////
        /////////
        var VerseRefMenu=function(){

        }


        ///////////
        //////////
        //////////
        //////////
        /////////

        function restapi_loadBibVolChpVrs() {
            var obj = gBim.get_chap_by_selected();
            console.log(obj);
            var inp = { fname: "KJV", dat: obj };
            var par = { api: "loadBibible_VolChpVrs", inp: inp };
            
            Jsonpster.Run(par, function (ret) {
                console.log(ret);
                var s = "<table border='1'>";
                $.each(ret, function (vol, chpObj) {
                    $.each(chpObj, function (chp, vrsObj) {
                        $.each(vrsObj, function (vrs, str) {
                            var bid = vol + chp + ":" + vrs;
                            s += "<tr><td/><td class='vid'>" + bid + "</td><td>";
                            s += str + "</td></tr>";
                        });
                    });
                });
                s += "</table>";
                $("#oBible").html(s).find(".vid").bind("click",function(){
                    var vid=$(this).text();
                    $(this).toggleClass("hili");
                    //alert(vid);
                });
                jsonpsvr_ok();
            });

            console.log(Jsonpster);
        };



        function restapi_loadBibleObj(fname, vobj) {
            
            //var txt = JSON.stringify(vobj);
            //xtxt = encodeURIComponent(txt);//must see svr decodeURIComponent();
            //var inp = { fname: "../../../jsdb/jsBibleObj/KJV.json.js", dat: vobj };
            var inp = { fname: "KJV", dat: vobj };
            var prm = { api: "loadBibleObj", inp: inp };
            //window.open(url);
            console.log(Jsonpster);
            //Jsonpster.Set ({api:"updateVocabHebrewBuf", param:inp}); // = JSON.stringify(inp);
            Jsonpster.Run(prm, function (ret) {
                console.log(ret);
                var s = "<table border='1'>";
                $.each(ret, function (vol, chpObj) {
                    $.each(chpObj, function (chp, vrsObj) {
                        $.each(vrsObj, function (vrs, str) {
                            var bid = vol + chp + ":" + vrs;
                            s += "<tr><td/><td>" + bid + "</td><td>";
                            s += str + "</td></tr>";
                        });
                    });
                });
                s += "</table>";
                $("#oBible").html(s);
                jsonpsvr_ok();
            });
        };

        function jsonpsvr_ok() {
            //https://www.w3schools.com/js/js_json_jsonp.asp
            var s = $("#out").val();
            if (s.length > 10) s = "";
            $("#texta").val(s + ".");
        }
    </script>

</HEAD>

<BODY>

    <textarea id="out"></textarea>


    <button id="indxer">indxer</button>
    <button id="load">load</button>




    <div id="BibInputMenuHolder" height="100%">

    </div>


    <table border="1">
        <thead>
            <tr>
                <td>#</td>
                <td>Vol</td>
                <td>Chp</td>
                <td>Ver</td>
            </tr>
        </thead>
        <tbody id="StructAna"></tbody>
    </table>


    <hr />
    <span id='oBible'>----</span>

</BODY>

</HTML>
<script type="text/javascript">

</script>